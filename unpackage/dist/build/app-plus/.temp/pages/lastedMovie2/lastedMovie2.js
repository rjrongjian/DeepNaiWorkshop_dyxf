require("../../common/manifest.js");
require("../../common/vendor.js");
global.webpackJsonp([2],[,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var s=n(i(1)),a=n(i(17));function n(t){return t&&t.__esModule?t:{default:t}}new s.default(a.default).$mount()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(19),a=i.n(s),n=i(27);var o=function(t){i(18)},r=i(0)(a.a,n.a,o,null,null);e.default=r.exports},function(t,e){},function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(20)),a=n(i(4));function n(t){return t&&t.__esModule?t:{default:t}}e.default={components:{uniDrawer:s.default,uniIcon:a.default},data:function(){return{isDisplayBanner:!0,itemList:[],indicatorDots:!0,autoplay:!0,interval:3e3,duration:300,refreshing:!1,isPullDownRefresh:!1,rightDrawerVisible:!1,movieCats:[],miniCats:[],loadMoreText:"",currentMovieList:[],fetchPageNum:1,totalPage:1,currentCat:-1,currentCatName:null,pageSize:9,arrIndex:0}},onLoad:function(){var t=this;2!=this.$myMovieApi.appUpdate.method&&4!=this.$myMovieApi.appUpdate.method&&(this.itemList=this.$myMovieApi.banners,console.debug("banner大小："+this.itemList.length),setTimeout(function(){t.getMovieCat()},300),this.getMovies())},onPullDownRefresh:function(){this.rightDrawerVisible&&(this.rightDrawerVisible=!1),this.isPullDownRefresh||(this.isPullDownRefresh=!0,t.setNavigationBarTitle({title:"今日更新"}),console.log("下拉刷新"),this.refreshing=!0,this.loadMoreText="",this.currentMovieList=[],this.fetchPageNum=1,this.totalPage=1,this.currentCat=-1,this.currentCatName=null,this.isDisplayBanner=!0,this.getMovies(),console.log("下拉刷新结尾"))},onReachBottom:function(){this.getMovies()},onNavigationBarButtonTap:function(t){this.rightDrawerVisible=!this.rightDrawerVisible},methods:{getData:function(){var e=this;t.request({url:"https://uniapp.dcloud.io/tuku/posts.php?page="+(this.refreshing?1:this.fetchPageNum)+"&per_page=10",success:function(i){if(200!==i.statusCode)console.log("请求失败:",i);else{if(e.refreshing&&i.data[0].id===e.lists[0][0].id)return t.showToast({title:"已经最新",icon:"none"}),e.refreshing=!1,void t.stopPullDownRefresh();for(var s=[],a=[],n=i.data,o=0,r=n.length;o<r;o++){Math.floor(o/2);s.push(n[o]),o%2==1&&(a.push(s),s=[])}console.log("得到lists",a),e.refreshing?(e.refreshing=!1,t.stopPullDownRefresh(),e.lists=a,e.fetchPageNum=2):(e.lists=e.lists.concat(a),e.fetchPageNum+=1)}}})},goDetail:function(e){t.navigateTo({url:"../movieDetail/movieDetail?data="+JSON.stringify(e)})},share:function(e){var i=this;if(0!==this.providerList.length){var s=this.providerList.map(function(t){return t.name});t.showActionSheet({itemList:s,success:function(s){t.share({provider:i.providerList[s.tapIndex].id,scene:i.providerList[s.tapIndex].type&&"WXSenceTimeline"===i.providerList[s.tapIndex].type?"WXSenceTimeline":"WXSceneSession",type:0,title:"uni-app模版",summary:e.title,imageUrl:e.img_src,href:"https://uniapp.dcloud.io",success:function(t){console.log("success:"+JSON.stringify(t))},fail:function(e){t.showModal({content:e.errMsg,showCancel:!1})}})}})}else t.showModal({title:"当前环境无分享渠道!",showCancel:!1})},closeRightDrawer:function(){this.rightDrawerVisible=!1},showRightDrawer:function(){this.rightDrawerVisible=!0},item1:function(){this.rightDrawerVisible=!1,t.showToast({title:"item1"})},item2:function(){this.rightDrawerVisible=!1,t.showToast({title:"item2"})},getTodayMovies:function(){var t=this.$myMovieApi.getMovieApi();if(t){var e=t.todayMovieApi+this.fetchPageNum;this.getMoviesBy(e)}else console.log("不能获取电影列表接口")},getMoviesByCat:function(){var t=this.$myMovieApi.getMovieApi();if(t){var e=t.getMovieByCat+"&pg="+this.fetchPageNum+"&t="+this.currentCat;this.getMoviesBy(e)}else console.log("不能获取按分类获取电影列表的接口");console.log("获取的catId："+this.currentCat+",获取的catName:"+this.currentCatName)},getMoviesBy:function(e){var i=this;if(console.log("加载电影,抓取页码："+this.fetchPageNum+",总页数："+this.totalPage+",调用的api:"+e),this.fetchPageNum>this.totalPage)return console.log("已经到最后一页,要抓取的页码："+this.fetchPageNum+",总页数:"+this.totalPage+"，抓取的分类id："+this.currentCat+",分类名称："+this.currentCatName),void(this.loadMoreText="已经到底了");this.loadMoreText="加载中...",t.request({url:e,success:function(e){if(200!==e.statusCode)console.log("获取今天更新的电影失败"+e),t.showToast({title:"限制抓取，请退出重试",icon:"none"});else{try{for(var s=i.$myXml2Json.xml_str2json(e.data),a=i.$myXml2Json.asArray(s.rss.list.video),n=[],o=0;o<a.length;o++){var r=a[o];if((-1!=i.currentCat||!i.$myMovieApi.isShieldingCatIdForToday(r.tid))&&!i.$myMovieApi.isShieldingMovieId(r.id)){var l=r.last,c=r.id,u=r.name,h=r.type,d=r.pic,g=r.lang,v=r.area,p=r.year,f=r.note,m=r.actor,y=r.director,w=r.des,C=i.$myXml2Json.asArray(r.dl.dd);w&&(w=(w=(w=(w=w.replace(new RegExp("<div>","g"),"")).replace(new RegExp("</div>","g"),"")).replace(new RegExp("&mdash;","g"),"-")).replace(new RegExp("&","g"),"")),y&&(y=(y=(y=(y=y.replace(new RegExp("<div>","g"),"")).replace(new RegExp("</div>","g"),"")).replace(new RegExp("&mdash;","g"),"-")).replace(new RegExp("&","g"),"")),m&&(m=(m=(m=(m=m.replace(new RegExp("<div>","g"),"")).replace(new RegExp("</div>","g"),"")).replace(new RegExp("&mdash;","g"),"-")).replace(new RegExp("&","g"),""));for(var M={},_=0;_<C.length;_++){var x=C[_]._flag,D=C[_];x&&-1!=x.indexOf("m3u8")&&(x="m3u8");var P=D.toString();M[x]=P}var b={id:c,updateTime:l,name:u,type:h,pic:d,language:g,area:v,year:p,note:f,actor:m,director:y,des:w,resUrl:M};n.length>=2?(i.currentMovieList.push(n),n=[]):n.push(b)}}i.refreshing=!1;var T=s.rss.list;i.fetchPageNum=i.fetchPageNum+1,i.totalPage=T._pagecount,i.loadMoreText=""}catch(t){console.log("解析电影列表失败，原因："+t),i.loadMoreText="获取电影失败，请下拉刷新",i.refreshing=!1}i.isPullDownRefresh&&(i.isPullDownRefresh=!1,t.stopPullDownRefresh())}},fail:function(e){t.showToast({title:"限制抓取，请重新尝试",icon:"none"})}})},getMovies:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isPullDownRefresh);else if(this.refreshing)return;if(this.refreshing=!0,console.debug("调用getMovies传进来的值，catId:"+e+",catName:"+i),e)try{var s=parseInt(e);this.currentCat!=s&&(this.loadMoreText="",this.currentMovieList=[],this.fetchPageNum=1,this.totalPage=1,this.currentCat=s,this.currentCatName=i)}catch(t){console.log("获取catId失败，获取的值"+e)}-1==this.currentCat?this.getTodayMovies():(this.isDisplayBanner=!1,i&&""!=i.trim()&&(this.currentCatName=i,t.setNavigationBarTitle({title:"专题："+i,fail:function(){console.log("更新导航栏失败")}})),this.getMoviesByCat())},getMovieCat:function(){var e=this;try{var i=this.$myMovieApi.getMovieApi();if(i){var s=i.movieTypeApi;t.request({url:s,success:function(t){if(200!==t.statusCode)console.log("获取电影分类失败",t);else{for(var i=e.$myXml2Json.xml_str2json(t.data),s=e.$myXml2Json.asArray(i.rss.class.ty),a=[],n=[],o=[],r=0;r<s.length;r++)e.$myMovieApi.isShieldingCatId(s[r]._id)||o.push(s[r]);for(r=0;r<o.length;r++){var l={name:o[r].__text,id:s[r]._id};n.length>=e.pageSize?(a.push(n),(n=[]).push(l)):r==o.length-1?(n.push(l),a.push(n),n=[]):n.push(l)}e.movieCats=a,e.miniCats=e.movieCats[e.arrIndex]}}})}else console.log("加载电影分类失败")}catch(t){console.log("加载电影分类出现异常",t)}},switchCats:function(){var t=this.arrIndex+1;t>Math.ceil(this.movieCats.length/this.pageSize)?(this.miniCats=this.movieCats[0],this.arrIndex=0):(this.arrIndex=t,this.miniCats=this.movieCats[t])},openBanner:function(e){console.log(e.openType+","+e.url+","+e.imgUrl),1==e.openType&&plus.runtime.openWeb(e.url),2==e.openType&&plus.runtime.openURL(e.url),3==e.openType&&"lingquansonghuiyuan"==e.url&&t.navigateTo({url:"../activity/lingquansonghuiyuan/lingquansonghuiyuan"})}}}}).call(e,i(2).default)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(22),a=i.n(s),n=i(23);var o=function(t){i(21)},r=i(0)(a.a,n.a,o,"data-v-b994e6e6",null);e.default=r.exports},function(t,e){},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{visible:{type:Boolean,default:!1},mode:String,mask:{type:[Boolean,String],default:!0},movieCatsIntoSon:{type:Array},getMoviesByCatInSon:{type:Function,default:null},switchCatsInSon:{type:Function,default:null}},data:function(){return{rightMode:!1}},computed:{showMask:function(){return"true"===String(this.mask)}},created:function(){this.rightMode="right"===this.mode},methods:{close:function(){this.$emit("close")},loadMovieByCat:function(t,e){this.close(),this.getMoviesByCatInSon(t,e)}}}},function(t,e,i){"use strict";var s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"uni-drawer",class:{"uni-drawer-visible":t.visible,"uni-drawer-right":t.rightMode}},[t.showMask?i("view",{staticClass:"uni-drawer-mask",attrs:{eventid:"Wis-0"},on:{tap:t.close}}):t._e(),i("view",{staticClass:"uni-drawer-content"},[i("view",{staticClass:"drawer-content"},[i("button",{staticClass:"primary btn-extra",attrs:{type:"primary",eventid:"9Qk-1"},on:{tap:t.switchCatsInSon}},[t._v("换一批")]),i("view",{staticClass:"uni-list"},t._l(t.movieCatsIntoSon,function(e,s){return i("block",{key:e.id},[i("view",{staticClass:"uni-list-cell",attrs:{"hover-class":"uni-list-cell-hover"}},[i("view",{staticClass:"uni-list-cell-navigate uni-navigate-right",attrs:{eventid:"2gm-2-"+s},on:{tap:function(i){t.loadMovieByCat(e.id,e.name)}}},[t._v("\n            \t\t\t\t\t"+t._s(e.name)+"\n            \t\t\t\t")])])])}))],1)])])},staticRenderFns:[]};e.a=s},,,,function(t,e,i){"use strict";var s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"container"},[t.isDisplayBanner&t.itemList.length>0?i("block",[i("swiper",{staticClass:"swiper-box",attrs:{"indicator-dots":t.indicatorDots,"indicator-active-color":"#79E8D0",autoplay:t.autoplay,interval:t.interval,duration:t.duration}},t._l(t.itemList,function(e,s){return i("swiper-item",{key:e,staticClass:"swiper-item",attrs:{eventid:"E0o-0-"+s,mpcomid:"Vtq-0-"+s},on:{tap:function(i){t.openBanner(e)}}},[i("image",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e.imgUrl,mode:"aspectFit"}})])}))],1):t._e(),i("view",{staticClass:"index movie-list"},[t._l(t.currentMovieList,function(e,s){return i("block",{key:s},[i("div",{staticClass:"row row-extra"},t._l(e,function(e,a){return i("div",{key:a,staticClass:"card card-list2 card-extra",attrs:{eventid:"Nv2-1-"+s+"-"+a},on:{click:function(i){t.goDetail(e)}}},[i("image",{staticClass:"card-img card-list2-img-1",attrs:{"lazy-load":"true",src:e.pic}}),i("div",{staticClass:"card-num-view card-list2-num-view"},[i("text",{staticClass:"card-num card-list2-num-1"},[t._v(t._s(e.type))])]),i("div",{staticClass:"card-bottm-1 column"},[i("div",{staticClass:"car-title-view-1 column"},[i("text",{staticClass:"card-title-2 card-list2-title card-title-1"},[t._v(t._s(e.name)+"["+t._s(e.note)+"]")]),i("text",{staticClass:"card-title card-list2-title-1"},[t._v("更新时间:"+t._s(e.updateTime))])])])])}))])}),i("text",{staticClass:"loadMore"},[t._v(t._s(t.loadMoreText))])],2),i("uni-drawer",{attrs:{visible:t.rightDrawerVisible,mode:"right",movieCatsIntoSon:t.miniCats,getMoviesByCatInSon:t.getMovies,switchCatsInSon:t.switchCats,eventid:"ryD-2",mpcomid:"y35-1"},on:{close:t.closeRightDrawer}})],1)},staticRenderFns:[]};e.a=s}],[16]);